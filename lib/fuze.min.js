/**
 * A jquery, future, dirt simple js template engine
 *
 * @todo Add alias map to options, for elements not named the same as their data
 * @todo Add map callbacks to options for additional manipulation. Needs access to the dom, the data item, and the original data object
 * @todo Bugfix - multiple dom elements that match the selector get screwy
 *
 * Fuze v0.4
 * Copyright (C) 2011 Sentient Matter
 * Licensed under the MIT license
 */

(function($){var methods={doFuze:function(data,options){var self=this;self.each(function(){$.each(data,function(key,item){var selector='#'+key+', '+'.'+key;var element=$(selector,self);methods.applyData.apply(self,[element,item,options]);});});},applyData:function(element,data,options){if(!element){return;}
var self=this;if($.isArray(data)){var original=$(element);var last=original;if(original){var clone=original.clone(true,true);$.each(data,function(key,item){if(!methods.isFuzeable.apply(self,[item])){return true;}
if(key>0){last=clone.clone(true,true).insertAfter(last);}else{last=original;}
methods.applyData.apply(self,[last,item,options]);});}}else if(data instanceof Object){if(data.toJSON&&typeof(data.toJSON)=='function'){data=data.toJSON();}
options.asynchronous=false;$(element).fuze(data,options);}else if(methods.isScalar.apply(self,[data])){element.html(data);}},isFuzeable:function(item){return item instanceof Object||methods.isScalar.apply(self,[item]);},isScalar:function(item){return typeof(item)=='string'||typeof(item)=='number'||typeof(item)=='boolean';}}
$.fn.fuze=function(data,options){var deferred=$.Deferred();var self=this;var defaults={asynchronous:true}
options||(options={});options=$.extend(defaults,options);if(options.asynchronous){setTimeout(function(){methods.doFuze.apply(self,[data,options]);deferred.resolveWith(self);},0);}else{methods.doFuze.apply(self,[data,options]);deferred.resolveWith(self);}
return deferred.promise(this);};})(jQuery)